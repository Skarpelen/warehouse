@using Warehouse.Shared
@using Warehouse.Shared.DTO
@inject NavigationManager Nav

<MudTable T="ShipmentDocumentDTO" Items="Shipments" Dense="true" Hover="true" OnRowClick="e => OnRowClick.InvokeAsync(e.Item.Id)">
    <HeaderContent>
        <MudTh>Номер</MudTh>
        <MudTh>Дата</MudTh>
        <MudTh>Клиент</MudTh>
        <MudTh>Статус</MudTh>
        <MudTh>Ресурс</MudTh>
        <MudTh>Ед. изм.</MudTh>
        <MudTh>Кол-во</MudTh>
    </HeaderContent>
    <RowTemplate>
	    @{
		    var visibleItems = context.Items.Where(i => i.Quantity > 0).ToList();
	    }
	    <MudTd DataLabel="Номер">@context.Number</MudTd>
	    <MudTd DataLabel="Дата">@context.Date.ToString("yyyy-MM-dd")</MudTd>
	    <MudTd DataLabel="Клиент">@context.Client.Name</MudTd>
	    <MudTd DataLabel="Статус">
		    @if (context.Status == ShipmentStatus.Signed)
		    {
				<MudChip T="ShipmentStatus"
						 Variant="Variant.Filled"
			             Color="Color.Success"
			             Disabled="true">
				    Подписан
			    </MudChip>
		    }
		    else
		    {
				<MudChip T="ShipmentStatus"
						 Variant="Variant.Filled"
			             Color="Color.Default"
			             Disabled="true">
				    Не подписан
			    </MudChip>
		    }
	    </MudTd>
        <MudTd DataLabel="Ресурс">@((MarkupString)string.Join("<br/>", visibleItems.Select(i => i.Resource.Name)))</MudTd>
        <MudTd DataLabel="Ед. изм.">@((MarkupString)string.Join("<br/>", visibleItems.Select(i => i.Unit.Name)))</MudTd>
        <MudTd DataLabel="Кол-во">@((MarkupString)string.Join("<br/>", visibleItems.Select(i => i.Quantity)))</MudTd>
    </RowTemplate>
    <NoRecordsContent>Нет данных для отображения</NoRecordsContent>
</MudTable>

@code {
    [Parameter] public IEnumerable<ShipmentDocumentDTO> Shipments { get; set; } = Array.Empty<ShipmentDocumentDTO>();
    [Parameter] public EventCallback<Guid> OnRowClick { get; set; }
}